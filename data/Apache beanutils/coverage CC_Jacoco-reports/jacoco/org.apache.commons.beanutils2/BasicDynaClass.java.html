<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="zh"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BasicDynaClass.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Apache Commons BeanUtils</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.beanutils2</a> &gt; <span class="el_source">BasicDynaClass.java</span></div><h1>BasicDynaClass.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


package org.apache.commons.beanutils2;


import java.io.Serializable;
import java.lang.reflect.Constructor;
import java.lang.reflect.InvocationTargetException;
import java.util.HashMap;


/**
 * &lt;p&gt;Minimal implementation of the &lt;code&gt;DynaClass&lt;/code&gt; interface.  Can be
 * used as a convenience base class for more sophisticated implementations.&lt;/p&gt;
 * &lt;p&gt;&lt;strong&gt;IMPLEMENTATION NOTE&lt;/strong&gt; - The &lt;code&gt;DynaBean&lt;/code&gt;
 * implementation class supplied to our constructor MUST have a one-argument
 * constructor of its own that accepts a &lt;code&gt;DynaClass&lt;/code&gt;.  This is
 * used to associate the DynaBean instance with this DynaClass.&lt;/p&gt;
 *
 * @version $Id$
 */

public class BasicDynaClass implements DynaClass, Serializable {

    private static final long serialVersionUID = 1L;

    // ----------------------------------------------------------- Constructors


    /**
     * Construct a new BasicDynaClass with default parameters.
     */
    public BasicDynaClass() {

<span class="fc" id="L51">        this(null, null, null);</span>

<span class="fc" id="L53">    }</span>


    /**
     * Construct a new BasicDynaClass with the specified parameters.
     *
     * @param name Name of this DynaBean class
     * @param dynaBeanClass The implementation class for new instances
     */
    public BasicDynaClass(final String name, final Class&lt;?&gt; dynaBeanClass) {

<span class="nc" id="L64">        this(name, dynaBeanClass, null);</span>

<span class="nc" id="L66">    }</span>


    /**
     * Construct a new BasicDynaClass with the specified parameters.
     *
     * @param name Name of this DynaBean class
     * @param dynaBeanClass The implementation class for new intances
     * @param properties Property descriptors for the supported properties
     */
    public BasicDynaClass(final String name, Class&lt;?&gt; dynaBeanClass,
                          final DynaProperty[] properties) {

<span class="fc" id="L79">        super();</span>
<span class="fc bfc" id="L80" title="All 2 branches covered.">        if (name != null) {</span>
<span class="fc" id="L81">            this.name = name;</span>
        }
<span class="fc bfc" id="L83" title="All 2 branches covered.">        if (dynaBeanClass == null) {</span>
<span class="fc" id="L84">            dynaBeanClass = BasicDynaBean.class;</span>
        }
<span class="fc" id="L86">        setDynaBeanClass(dynaBeanClass);</span>
<span class="fc bfc" id="L87" title="All 2 branches covered.">        if (properties != null) {</span>
<span class="fc" id="L88">            setProperties(properties);</span>
        }

<span class="fc" id="L91">    }</span>


    // ----------------------------------------------------- Instance Variables


    /**
     * The constructor of the &lt;code&gt;dynaBeanClass&lt;/code&gt; that we will use
     * for creating new instances.
     */
<span class="fc" id="L101">    protected transient Constructor&lt;?&gt; constructor = null;</span>


    /**
     * The method signature of the constructor we will use to create
     * new DynaBean instances.
     */
<span class="fc" id="L108">    protected static Class&lt;?&gt;[] constructorTypes = { DynaClass.class };</span>


    /**
     * The argument values to be passed to the constructore we will use
     * to create new DynaBean instances.
     */
<span class="fc" id="L115">    protected Object[] constructorValues = { this };</span>


    /**
     * The &lt;code&gt;DynaBean&lt;/code&gt; implementation class we will use for
     * creating new instances.
     */
<span class="fc" id="L122">    protected Class&lt;?&gt; dynaBeanClass = BasicDynaBean.class;</span>


    /**
     * The &quot;name&quot; of this DynaBean class.
     */
<span class="fc" id="L128">    protected String name = this.getClass().getName();</span>


    /**
     * The set of dynamic properties that are part of this DynaClass.
     */
<span class="fc" id="L134">    protected DynaProperty[] properties = new DynaProperty[0];</span>


    /**
     * The set of dynamic properties that are part of this DynaClass,
     * keyed by the property name.  Individual descriptor instances will
     * be the same instances as those in the &lt;code&gt;properties&lt;/code&gt; list.
     */
<span class="fc" id="L142">    protected HashMap&lt;String, DynaProperty&gt; propertiesMap = new HashMap&lt;&gt;();</span>


    // ------------------------------------------------------ DynaClass Methods


    /**
     * Return the name of this DynaClass (analogous to the
     * {@code getName()} method of {@code java.lang.Class}, which
     * allows the same {@code DynaClass} implementation class to support
     * different dynamic classes, with different sets of properties.
     *
     * @return the name of the DynaClass
     */
    @Override
    public String getName() {

<span class="nc" id="L159">        return this.name;</span>

    }


    /**
     * Return a property descriptor for the specified property, if it exists;
     * otherwise, return {@code null}.
     *
     * @param name Name of the dynamic property for which a descriptor
     *  is requested
     * @return The descriptor for the specified property
     *
     * @throws IllegalArgumentException if no property name is specified
     */
    @Override
    public DynaProperty getDynaProperty(final String name) {

<span class="fc bfc" id="L177" title="All 2 branches covered.">        if (name == null) {</span>
<span class="fc" id="L178">            throw new IllegalArgumentException</span>
                    (&quot;No property name specified&quot;);
        }
<span class="fc" id="L181">        return propertiesMap.get(name);</span>

    }


    /**
     * &lt;p&gt;Return an array of {@code ProperyDescriptors} for the properties
     * currently defined in this DynaClass.  If no properties are defined, a
     * zero-length array will be returned.&lt;/p&gt;
     *
     * &lt;p&gt;&lt;strong&gt;FIXME&lt;/strong&gt; - Should we really be implementing
     * {@code getBeanInfo()} instead, which returns property descriptors
     * and a bunch of other stuff?&lt;/p&gt;
     *
     * @return the set of properties for this DynaClass
     */
    @Override
    public DynaProperty[] getDynaProperties() {

<span class="fc" id="L200">        return properties;</span>

    }


    /**
     * Instantiate and return a new DynaBean instance, associated
     * with this DynaClass.
     *
     * @return A new {@code DynaBean} instance
     * @throws IllegalAccessException if the Class or the appropriate
     *  constructor is not accessible
     * @throws InstantiationException if this Class represents an abstract
     *  class, an array class, a primitive type, or void; or if instantiation
     *  fails for some other reason
     */
    @Override
    public DynaBean newInstance()
            throws IllegalAccessException, InstantiationException {

        try {
            // Refind the constructor after a deserialization (if needed)
<span class="fc bfc" id="L222" title="All 2 branches covered.">            if (constructor == null) {</span>
<span class="fc" id="L223">                setDynaBeanClass(this.dynaBeanClass);</span>
            }
            // Invoke the constructor to create a new bean instance
<span class="fc" id="L226">            return (DynaBean) constructor.newInstance(constructorValues);</span>
<span class="nc" id="L227">        } catch (final InvocationTargetException e) {</span>
<span class="nc" id="L228">            throw new InstantiationException</span>
<span class="nc" id="L229">                    (e.getTargetException().getMessage());</span>
        }

    }


    // --------------------------------------------------------- Public Methods


    /**
     * Return the Class object we will use to create new instances in the
     * {@code newInstance()} method.  This Class &lt;strong&gt;MUST&lt;/strong&gt;
     * implement the {@code DynaBean} interface.
     *
     * @return The class of the {@link DynaBean}
     */
    public Class&lt;?&gt; getDynaBeanClass() {

<span class="nc" id="L247">        return this.dynaBeanClass;</span>

    }


    // ------------------------------------------------------ Protected Methods


    /**
     * Set the Class object we will use to create new instances in the
     * {@code newInstance()} method.  This Class &lt;strong&gt;MUST&lt;/strong&gt;
     * implement the {@code DynaBean} interface.
     *
     * @param dynaBeanClass The new Class object
     *
     * @throws IllegalArgumentException if the specified Class does not
     *  implement the {@code DynaBean} interface
     */
    protected void setDynaBeanClass(final Class&lt;?&gt; dynaBeanClass) {

        // Validate the argument type specified
<span class="pc bpc" id="L268" title="1 of 2 branches missed.">        if (dynaBeanClass.isInterface()) {</span>
<span class="nc" id="L269">            throw new IllegalArgumentException</span>
<span class="nc" id="L270">                    (&quot;Class &quot; + dynaBeanClass.getName() +</span>
                    &quot; is an interface, not a class&quot;);
        }
<span class="pc bpc" id="L273" title="1 of 2 branches missed.">        if (!DynaBean.class.isAssignableFrom(dynaBeanClass)) {</span>
<span class="nc" id="L274">            throw new IllegalArgumentException</span>
<span class="nc" id="L275">                    (&quot;Class &quot; + dynaBeanClass.getName() +</span>
                    &quot; does not implement DynaBean&quot;);
        }

        // Identify the Constructor we will use in newInstance()
        try {
<span class="fc" id="L281">            this.constructor = dynaBeanClass.getConstructor(constructorTypes);</span>
<span class="nc" id="L282">        } catch (final NoSuchMethodException e) {</span>
<span class="nc" id="L283">            throw new IllegalArgumentException</span>
<span class="nc" id="L284">                    (&quot;Class &quot; + dynaBeanClass.getName() +</span>
                    &quot; does not have an appropriate constructor&quot;);
<span class="fc" id="L286">        }</span>
<span class="fc" id="L287">        this.dynaBeanClass = dynaBeanClass;</span>

<span class="fc" id="L289">    }</span>


    /**
     * Set the list of dynamic properties supported by this DynaClass.
     *
     * @param properties List of dynamic properties to be supported
     */
    protected void setProperties(final DynaProperty[] properties) {

<span class="fc" id="L299">        this.properties = properties;</span>
<span class="fc" id="L300">        propertiesMap.clear();</span>
<span class="fc bfc" id="L301" title="All 2 branches covered.">        for (final DynaProperty propertie : properties) {</span>
<span class="fc" id="L302">            propertiesMap.put(propertie.getName(), propertie);</span>
        }

<span class="fc" id="L305">    }</span>


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>