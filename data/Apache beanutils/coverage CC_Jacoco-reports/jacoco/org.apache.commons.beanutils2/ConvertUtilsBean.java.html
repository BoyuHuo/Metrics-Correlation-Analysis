<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="zh"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ConvertUtilsBean.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Apache Commons BeanUtils</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.beanutils2</a> &gt; <span class="el_source">ConvertUtilsBean.java</span></div><h1>ConvertUtilsBean.java</h1><pre class="source lang-java linenums">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


package org.apache.commons.beanutils2;


import java.io.File;
import java.lang.reflect.Array;
import java.math.BigDecimal;
import java.math.BigInteger;
import java.net.URL;
import java.sql.Timestamp;
import java.util.Calendar;
import java.util.Collection;

import org.apache.commons.beanutils2.converters.ArrayConverter;
import org.apache.commons.beanutils2.converters.BigDecimalConverter;
import org.apache.commons.beanutils2.converters.BigIntegerConverter;
import org.apache.commons.beanutils2.converters.BooleanConverter;
import org.apache.commons.beanutils2.converters.ByteConverter;
import org.apache.commons.beanutils2.converters.CalendarConverter;
import org.apache.commons.beanutils2.converters.CharacterConverter;
import org.apache.commons.beanutils2.converters.ClassConverter;
import org.apache.commons.beanutils2.converters.ConverterFacade;
import org.apache.commons.beanutils2.converters.DateConverter;
import org.apache.commons.beanutils2.converters.DoubleConverter;
import org.apache.commons.beanutils2.converters.FileConverter;
import org.apache.commons.beanutils2.converters.FloatConverter;
import org.apache.commons.beanutils2.converters.IntegerConverter;
import org.apache.commons.beanutils2.converters.LongConverter;
import org.apache.commons.beanutils2.converters.ShortConverter;
import org.apache.commons.beanutils2.converters.SqlDateConverter;
import org.apache.commons.beanutils2.converters.SqlTimeConverter;
import org.apache.commons.beanutils2.converters.SqlTimestampConverter;
import org.apache.commons.beanutils2.converters.StringConverter;
import org.apache.commons.beanutils2.converters.URLConverter;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;


/**
 * &lt;p&gt;Utility methods for converting String scalar values to objects of the
 * specified Class, String arrays to arrays of the specified Class.  The
 * actual {@link Converter} instance to be used can be registered for each
 * possible destination Class.  Unless you override them, standard
 * {@link Converter} instances are provided for all of the following
 * destination Classes:&lt;/p&gt;
 * &lt;ul&gt;
 * &lt;li&gt;java.lang.BigDecimal (no default value)&lt;/li&gt;
 * &lt;li&gt;java.lang.BigInteger (no default value)&lt;/li&gt;
 * &lt;li&gt;boolean and java.lang.Boolean (default to false)&lt;/li&gt;
 * &lt;li&gt;byte and java.lang.Byte (default to zero)&lt;/li&gt;
 * &lt;li&gt;char and java.lang.Character (default to a space)&lt;/li&gt;
 * &lt;li&gt;java.lang.Class (no default value)&lt;/li&gt;
 * &lt;li&gt;double and java.lang.Double (default to zero)&lt;/li&gt;
 * &lt;li&gt;float and java.lang.Float (default to zero)&lt;/li&gt;
 * &lt;li&gt;int and java.lang.Integer (default to zero)&lt;/li&gt;
 * &lt;li&gt;long and java.lang.Long (default to zero)&lt;/li&gt;
 * &lt;li&gt;short and java.lang.Short (default to zero)&lt;/li&gt;
 * &lt;li&gt;java.lang.String (default to null)&lt;/li&gt;
 * &lt;li&gt;java.io.File (no default value)&lt;/li&gt;
 * &lt;li&gt;java.net.URL (no default value)&lt;/li&gt;
 * &lt;li&gt;java.sql.Date (no default value)&lt;/li&gt;
 * &lt;li&gt;java.sql.Time (no default value)&lt;/li&gt;
 * &lt;li&gt;java.sql.Timestamp (no default value)&lt;/li&gt;
 * &lt;/ul&gt;
 *
 * &lt;p&gt;For backwards compatibility, the standard Converters for primitive
 * types (and the corresponding wrapper classes) return a defined
 * default value when a conversion error occurs.  If you prefer to have a
 * {@link ConversionException} thrown instead, replace the standard Converter
 * instances with instances created with the zero-arguments constructor.  For
 * example, to cause the Converters for integers to throw an exception on
 * conversion errors, you could do this:&lt;/p&gt;
 * &lt;pre&gt;
 *   // No-args constructor gets the version that throws exceptions
 *   Converter myConverter =
 *    new org.apache.commons.beanutils2.converter.IntegerConverter();
 *   ConvertUtils.register(myConverter, Integer.TYPE);    // Native type
 *   ConvertUtils.register(myConverter, Integer.class);   // Wrapper class
 * &lt;/pre&gt;
 *
 * &lt;p&gt;
 * Converters generally treat null input as if it were invalid
 * input, ie they return their default value if one was specified when the
 * converter was constructed, and throw an exception otherwise. If you prefer
 * nulls to be preserved for converters that are converting to objects (not
 * primitives) then register a converter as above, passing a default value of
 * null to the converter constructor (and of course registering that converter
 * only for the .class target).
 * &lt;/p&gt;
 *
 * &lt;p&gt;
 * When a converter is listed above as having no default value, then that
 * converter will throw an exception when passed null or an invalid value
 * as its input. In particular, by default the BigInteger and BigDecimal
 * converters have no default (and are therefore somewhat inconsistent
 * with the other numerical converters which all have zero as their default).
 * &lt;/p&gt;
 *
 * &lt;p&gt;
 * Converters that generate &lt;i&gt;arrays&lt;/i&gt; of each of the primitive types are
 * also automatically configured (including String[]). When passed null
 * or invalid input, these return an empty array (not null). See class
 * AbstractArrayConverter for the supported input formats for these converters.
 * &lt;/p&gt;
 *
 * @version $Id$
 * @since 1.7
 */

public class ConvertUtilsBean {

<span class="fc" id="L129">    private static final Integer ZERO = Integer.valueOf(0);</span>
<span class="fc" id="L130">    private static final Character SPACE = Character.valueOf(' ');</span>

    // ------------------------------------------------------- Class Methods
    /**
     * Get singleton instance
     * @return The singleton instance
     */
    protected static ConvertUtilsBean getInstance() {
<span class="fc" id="L138">        return BeanUtilsBean.getInstance().getConvertUtils();</span>
    }

    // ------------------------------------------------------- Variables


    /**
     * The set of {@link Converter}s that can be used to convert Strings
     * into objects of a specified Class, keyed by the destination Class.
     */
<span class="fc" id="L148">    private final WeakFastHashMap&lt;Class&lt;?&gt;, Converter&gt; converters =</span>
            new WeakFastHashMap&lt;&gt;();

    /**
     * The &lt;code&gt;Log&lt;/code&gt; instance for this class.
     */
<span class="fc" id="L154">    private final Log log = LogFactory.getLog(ConvertUtilsBean.class);</span>

    // ------------------------------------------------------- Constructors

    /** Construct a bean with standard converters registered */
<span class="fc" id="L159">    public ConvertUtilsBean() {</span>
<span class="fc" id="L160">        converters.setFast(false);</span>
<span class="fc" id="L161">        deregister();</span>
<span class="fc" id="L162">        converters.setFast(true);</span>
<span class="fc" id="L163">    }</span>

    // --------------------------------------------------------- Public Methods

    /**
     * Convert the specified value into a String.  If the specified value
     * is an array, the first element (converted to a String) will be
     * returned.  The registered {@link Converter} for the
     * &lt;code&gt;java.lang.String&lt;/code&gt; class will be used, which allows
     * applications to customize Object-&amp;gt;String conversions (the default
     * implementation simply uses toString()).
     *
     * @param value Value to be converted (may be null)
     * @return The converted String value or null if value is null
     */
    public String convert(Object value) {

<span class="fc bfc" id="L180" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L181">            return null;</span>
<span class="fc bfc" id="L182" title="All 2 branches covered.">        } else if (value.getClass().isArray()) {</span>
<span class="fc bfc" id="L183" title="All 2 branches covered.">            if (Array.getLength(value) &lt; 1) {</span>
<span class="fc" id="L184">                return null;</span>
            }
<span class="fc" id="L186">            value = Array.get(value, 0);</span>
<span class="pc bpc" id="L187" title="1 of 2 branches missed.">            if (value == null) {</span>
<span class="nc" id="L188">                return null;</span>
            }
<span class="fc" id="L190">            final Converter converter = lookup(String.class);</span>
<span class="fc" id="L191">            return converter.convert(String.class, value);</span>
        } else {
<span class="fc" id="L193">            final Converter converter = lookup(String.class);</span>
<span class="fc" id="L194">            return converter.convert(String.class, value);</span>
        }

    }


    /**
     * Convert the specified value to an object of the specified class (if
     * possible).  Otherwise, return a String representation of the value.
     *
     * @param value Value to be converted (may be null)
     * @param clazz Java class to be converted to (must not be null)
     * @return The converted value
     *
     * @throws ConversionException if thrown by an underlying Converter
     */
    public Object convert(final String value, final Class&lt;?&gt; clazz) {

<span class="pc bpc" id="L212" title="1 of 2 branches missed.">        if (log.isDebugEnabled()) {</span>
<span class="nc" id="L213">            log.debug(&quot;Convert string '&quot; + value + &quot;' to class '&quot; +</span>
<span class="nc" id="L214">                      clazz.getName() + &quot;'&quot;);</span>
        }
<span class="fc" id="L216">        Converter converter = lookup(clazz);</span>
<span class="fc bfc" id="L217" title="All 2 branches covered.">        if (converter == null) {</span>
<span class="fc" id="L218">            converter = lookup(String.class);</span>
        }
<span class="pc bpc" id="L220" title="1 of 2 branches missed.">        if (log.isTraceEnabled()) {</span>
<span class="nc" id="L221">            log.trace(&quot;  Using converter &quot; + converter);</span>
        }
<span class="fc" id="L223">        return converter.convert(clazz, value);</span>

    }


    /**
     * Convert an array of specified values to an array of objects of the
     * specified class (if possible).  If the specified Java class is itself
     * an array class, this class will be the type of the returned value.
     * Otherwise, an array will be constructed whose component type is the
     * specified class.
     *
     * @param values Array of values to be converted
     * @param clazz Java array or element class to be converted to (must not be null)
     * @return The converted value
     *
     * @throws ConversionException if thrown by an underlying Converter
     */
    public Object convert(final String[] values, final Class&lt;?&gt; clazz) {

<span class="fc" id="L243">        Class&lt;?&gt; type = clazz;</span>
<span class="fc bfc" id="L244" title="All 2 branches covered.">        if (clazz.isArray()) {</span>
<span class="fc" id="L245">            type = clazz.getComponentType();</span>
        }
<span class="pc bpc" id="L247" title="1 of 2 branches missed.">        if (log.isDebugEnabled()) {</span>
<span class="nc" id="L248">            log.debug(&quot;Convert String[&quot; + values.length + &quot;] to class '&quot; +</span>
<span class="nc" id="L249">                      type.getName() + &quot;[]'&quot;);</span>
        }
<span class="fc" id="L251">        Converter converter = lookup(type);</span>
<span class="pc bpc" id="L252" title="1 of 2 branches missed.">        if (converter == null) {</span>
<span class="nc" id="L253">            converter = lookup(String.class);</span>
        }
<span class="pc bpc" id="L255" title="1 of 2 branches missed.">        if (log.isTraceEnabled()) {</span>
<span class="nc" id="L256">            log.trace(&quot;  Using converter &quot; + converter);</span>
        }
<span class="fc" id="L258">        final Object array = Array.newInstance(type, values.length);</span>
<span class="fc bfc" id="L259" title="All 2 branches covered.">        for (int i = 0; i &lt; values.length; i++) {</span>
<span class="fc" id="L260">            Array.set(array, i, converter.convert(type, values[i]));</span>
        }
<span class="fc" id="L262">        return array;</span>

    }


    /**
     * Convert the value to an object of the specified class (if
     * possible). If no converter for the desired target type is registered,
     * the passed in object is returned unchanged.
     *
     * @param value Value to be converted (may be null)
     * @param targetType Class of the value to be converted to (must not be null)
     * @return The converted value
     *
     * @throws ConversionException if thrown by an underlying Converter
     */
    public Object convert(final Object value, final Class&lt;?&gt; targetType) {

<span class="fc bfc" id="L280" title="All 2 branches covered.">        final Class&lt;?&gt; sourceType = value == null ? null : value.getClass();</span>

<span class="pc bpc" id="L282" title="1 of 2 branches missed.">        if (log.isDebugEnabled()) {</span>
<span class="nc bnc" id="L283" title="All 2 branches missed.">            if (value == null) {</span>
<span class="nc" id="L284">                log.debug(&quot;Convert null value to type '&quot; +</span>
<span class="nc" id="L285">                        targetType.getName() + &quot;'&quot;);</span>
            } else {
<span class="nc" id="L287">                log.debug(&quot;Convert type '&quot; + sourceType.getName() + &quot;' value '&quot; + value +</span>
<span class="nc" id="L288">                      &quot;' to type '&quot; + targetType.getName() + &quot;'&quot;);</span>
            }
        }

<span class="fc" id="L292">        Object converted = value;</span>
<span class="fc" id="L293">        Converter converter = lookup(sourceType, targetType);</span>
<span class="fc bfc" id="L294" title="All 2 branches covered.">        if (converter != null) {</span>
<span class="pc bpc" id="L295" title="1 of 2 branches missed.">            if (log.isTraceEnabled()) {</span>
<span class="nc" id="L296">                log.trace(&quot;  Using converter &quot; + converter);</span>
            }
<span class="fc" id="L298">            converted = converter.convert(targetType, value);</span>
        }
<span class="fc bfc" id="L300" title="All 6 branches covered.">        if (String.class.equals(targetType) &amp;&amp; converted != null &amp;&amp;</span>
                !(converted instanceof String)) {

            // NOTE: For backwards compatibility, if the Converter
            //       doesn't handle  conversion--&gt;String then
            //       use the registered String Converter
<span class="fc" id="L306">            converter = lookup(String.class);</span>
<span class="fc bfc" id="L307" title="All 2 branches covered.">            if (converter != null) {</span>
<span class="pc bpc" id="L308" title="1 of 2 branches missed.">                if (log.isTraceEnabled()) {</span>
<span class="nc" id="L309">                    log.trace(&quot;  Using converter &quot; + converter);</span>
                }
<span class="fc" id="L311">                converted = converter.convert(String.class, converted);</span>
            }

            // If the object still isn't a String, use toString() method
<span class="pc bpc" id="L315" title="1 of 4 branches missed.">            if (converted != null &amp;&amp; !(converted instanceof String)) {</span>
<span class="fc" id="L316">                converted = converted.toString();</span>
            }

        }
<span class="fc" id="L320">        return converted;</span>

    }

    /**
     * Remove all registered {@link Converter}s, and re-establish the
     * standard Converters.
     */
    public void deregister() {

<span class="fc" id="L330">        converters.clear();</span>

<span class="fc" id="L332">        registerPrimitives(false);</span>
<span class="fc" id="L333">        registerStandard(false, false);</span>
<span class="fc" id="L334">        registerOther(true);</span>
<span class="fc" id="L335">        registerArrays(false, 0);</span>
<span class="fc" id="L336">        register(BigDecimal.class, new BigDecimalConverter());</span>
<span class="fc" id="L337">        register(BigInteger.class, new BigIntegerConverter());</span>
<span class="fc" id="L338">    }</span>

    /**
     * Register the provided converters with the specified defaults.
     *
     * @param throwException &lt;code&gt;true&lt;/code&gt; if the converters should
     * throw an exception when a conversion error occurs, otherwise
     * &lt;code&gt;false&lt;/code&gt; if a default value should be used.
     * @param defaultNull &lt;code&gt;true&lt;/code&gt;if the &lt;i&gt;standard&lt;/i&gt; converters
     * (see {@link ConvertUtilsBean#registerStandard(boolean, boolean)})
     * should use a default value of &lt;code&gt;null&lt;/code&gt;, otherwise &lt;code&gt;false&lt;/code&gt;.
     * N.B. This values is ignored if &lt;code&gt;throwException&lt;/code&gt; is &lt;code&gt;true&lt;/code&gt;
     * @param defaultArraySize The size of the default array value for array converters
     * (N.B. This values is ignored if &lt;code&gt;throwException&lt;/code&gt; is &lt;code&gt;true&lt;/code&gt;).
     * Specifying a value less than zero causes a &lt;code&gt;null&lt;/code&gt; value to be used for
     * the default.
     */
    public void register(final boolean throwException, final boolean defaultNull, final int defaultArraySize) {
<span class="nc" id="L356">        registerPrimitives(throwException);</span>
<span class="nc" id="L357">        registerStandard(throwException, defaultNull);</span>
<span class="nc" id="L358">        registerOther(throwException);</span>
<span class="nc" id="L359">        registerArrays(throwException, defaultArraySize);</span>
<span class="nc" id="L360">    }</span>

    /**
     * Register the converters for primitive types.
     * &lt;/p&gt;
     * This method registers the following converters:
     * &lt;ul&gt;
     *     &lt;li&gt;&lt;code&gt;Boolean.TYPE&lt;/code&gt; - {@link BooleanConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;Byte.TYPE&lt;/code&gt; - {@link ByteConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;Character.TYPE&lt;/code&gt; - {@link CharacterConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;Double.TYPE&lt;/code&gt; - {@link DoubleConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;Float.TYPE&lt;/code&gt; - {@link FloatConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;Integer.TYPE&lt;/code&gt; - {@link IntegerConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;Long.TYPE&lt;/code&gt; - {@link LongConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;Short.TYPE&lt;/code&gt; - {@link ShortConverter}&lt;/li&gt;
     * &lt;/ul&gt;
     * @param throwException &lt;code&gt;true&lt;/code&gt; if the converters should
     * throw an exception when a conversion error occurs, otherwise &lt;code&gt;
     * &lt;code&gt;false&lt;/code&gt; if a default value should be used.
     */
    private void registerPrimitives(final boolean throwException) {
<span class="pc bpc" id="L381" title="1 of 2 branches missed.">        register(Boolean.TYPE,   throwException ? new BooleanConverter()    : new BooleanConverter(Boolean.FALSE));</span>
<span class="pc bpc" id="L382" title="1 of 2 branches missed.">        register(Byte.TYPE,      throwException ? new ByteConverter()       : new ByteConverter(ZERO));</span>
<span class="pc bpc" id="L383" title="1 of 2 branches missed.">        register(Character.TYPE, throwException ? new CharacterConverter()  : new CharacterConverter(SPACE));</span>
<span class="pc bpc" id="L384" title="1 of 2 branches missed.">        register(Double.TYPE,    throwException ? new DoubleConverter()     : new DoubleConverter(ZERO));</span>
<span class="pc bpc" id="L385" title="1 of 2 branches missed.">        register(Float.TYPE,     throwException ? new FloatConverter()      : new FloatConverter(ZERO));</span>
<span class="pc bpc" id="L386" title="1 of 2 branches missed.">        register(Integer.TYPE,   throwException ? new IntegerConverter()    : new IntegerConverter(ZERO));</span>
<span class="pc bpc" id="L387" title="1 of 2 branches missed.">        register(Long.TYPE,      throwException ? new LongConverter()       : new LongConverter(ZERO));</span>
<span class="pc bpc" id="L388" title="1 of 2 branches missed.">        register(Short.TYPE,     throwException ? new ShortConverter()      : new ShortConverter(ZERO));</span>
<span class="fc" id="L389">    }</span>

    /**
     * Register the converters for standard types.
     * &lt;/p&gt;
     * This method registers the following converters:
     * &lt;ul&gt;
     *     &lt;li&gt;&lt;code&gt;BigDecimal.class&lt;/code&gt; - {@link BigDecimalConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;BigInteger.class&lt;/code&gt; - {@link BigIntegerConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;Boolean.class&lt;/code&gt; - {@link BooleanConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;Byte.class&lt;/code&gt; - {@link ByteConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;Character.class&lt;/code&gt; - {@link CharacterConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;Double.class&lt;/code&gt; - {@link DoubleConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;Float.class&lt;/code&gt; - {@link FloatConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;Integer.class&lt;/code&gt; - {@link IntegerConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;Long.class&lt;/code&gt; - {@link LongConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;Short.class&lt;/code&gt; - {@link ShortConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;String.class&lt;/code&gt; - {@link StringConverter}&lt;/li&gt;
     * &lt;/ul&gt;
     * @param throwException &lt;code&gt;true&lt;/code&gt; if the converters should
     * throw an exception when a conversion error occurs, otherwise &lt;code&gt;
     * &lt;code&gt;false&lt;/code&gt; if a default value should be used.
     * @param defaultNull &lt;code&gt;true&lt;/code&gt;if the &lt;i&gt;standard&lt;/i&gt; converters
     * (see {@link ConvertUtilsBean#registerStandard(boolean, boolean)})
     * should use a default value of &lt;code&gt;null&lt;/code&gt;, otherwise &lt;code&gt;false&lt;/code&gt;.
     * N.B. This values is ignored if &lt;code&gt;throwException&lt;/code&gt; is &lt;code&gt;true&lt;/code&gt;
     */
    private void registerStandard(final boolean throwException, final boolean defaultNull) {

<span class="pc bpc" id="L418" title="1 of 2 branches missed.">        final Number     defaultNumber     = defaultNull ? null : ZERO;</span>
<span class="pc bpc" id="L419" title="1 of 2 branches missed.">        final BigDecimal bigDecDeflt       = defaultNull ? null : new BigDecimal(&quot;0.0&quot;);</span>
<span class="pc bpc" id="L420" title="1 of 2 branches missed.">        final BigInteger bigIntDeflt       = defaultNull ? null : new BigInteger(&quot;0&quot;);</span>
<span class="pc bpc" id="L421" title="1 of 2 branches missed.">        final Boolean    booleanDefault    = defaultNull ? null : Boolean.FALSE;</span>
<span class="pc bpc" id="L422" title="1 of 2 branches missed.">        final Character  charDefault       = defaultNull ? null : SPACE;</span>
<span class="pc bpc" id="L423" title="1 of 2 branches missed.">        final String     stringDefault     = defaultNull ? null : &quot;&quot;;</span>

<span class="pc bpc" id="L425" title="1 of 2 branches missed.">        register(BigDecimal.class, throwException ? new BigDecimalConverter() : new BigDecimalConverter(bigDecDeflt));</span>
<span class="pc bpc" id="L426" title="1 of 2 branches missed.">        register(BigInteger.class, throwException ? new BigIntegerConverter() : new BigIntegerConverter(bigIntDeflt));</span>
<span class="pc bpc" id="L427" title="1 of 2 branches missed.">        register(Boolean.class,    throwException ? new BooleanConverter()    : new BooleanConverter(booleanDefault));</span>
<span class="pc bpc" id="L428" title="1 of 2 branches missed.">        register(Byte.class,       throwException ? new ByteConverter()       : new ByteConverter(defaultNumber));</span>
<span class="pc bpc" id="L429" title="1 of 2 branches missed.">        register(Character.class,  throwException ? new CharacterConverter()  : new CharacterConverter(charDefault));</span>
<span class="pc bpc" id="L430" title="1 of 2 branches missed.">        register(Double.class,     throwException ? new DoubleConverter()     : new DoubleConverter(defaultNumber));</span>
<span class="pc bpc" id="L431" title="1 of 2 branches missed.">        register(Float.class,      throwException ? new FloatConverter()      : new FloatConverter(defaultNumber));</span>
<span class="pc bpc" id="L432" title="1 of 2 branches missed.">        register(Integer.class,    throwException ? new IntegerConverter()    : new IntegerConverter(defaultNumber));</span>
<span class="pc bpc" id="L433" title="1 of 2 branches missed.">        register(Long.class,       throwException ? new LongConverter()       : new LongConverter(defaultNumber));</span>
<span class="pc bpc" id="L434" title="1 of 2 branches missed.">        register(Short.class,      throwException ? new ShortConverter()      : new ShortConverter(defaultNumber));</span>
<span class="pc bpc" id="L435" title="1 of 2 branches missed.">        register(String.class,     throwException ? new StringConverter()     : new StringConverter(stringDefault));</span>

<span class="fc" id="L437">    }</span>

    /**
     * Register the converters for other types.
     * &lt;/p&gt;
     * This method registers the following converters:
     * &lt;ul&gt;
     *     &lt;li&gt;&lt;code&gt;Class.class&lt;/code&gt; - {@link ClassConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;java.util.Date.class&lt;/code&gt; - {@link DateConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;java.util.Calendar.class&lt;/code&gt; - {@link CalendarConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;File.class&lt;/code&gt; - {@link FileConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;java.sql.Date.class&lt;/code&gt; - {@link SqlDateConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;java.sql.Time.class&lt;/code&gt; - {@link SqlTimeConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;java.sql.Timestamp.class&lt;/code&gt; - {@link SqlTimestampConverter}&lt;/li&gt;
     *     &lt;li&gt;&lt;code&gt;URL.class&lt;/code&gt; - {@link URLConverter}&lt;/li&gt;
     * &lt;/ul&gt;
     * @param throwException &lt;code&gt;true&lt;/code&gt; if the converters should
     * throw an exception when a conversion error occurs, otherwise &lt;code&gt;
     * &lt;code&gt;false&lt;/code&gt; if a default value should be used.
     */
    private void registerOther(final boolean throwException) {
<span class="pc bpc" id="L458" title="1 of 2 branches missed.">        register(Class.class,         throwException ? new ClassConverter()        : new ClassConverter(null));</span>
<span class="pc bpc" id="L459" title="1 of 2 branches missed.">        register(java.util.Date.class, throwException ? new DateConverter()        : new DateConverter(null));</span>
<span class="pc bpc" id="L460" title="1 of 2 branches missed.">        register(Calendar.class,      throwException ? new CalendarConverter()     : new CalendarConverter(null));</span>
<span class="pc bpc" id="L461" title="1 of 2 branches missed.">        register(File.class,          throwException ? new FileConverter()         : new FileConverter(null));</span>
<span class="pc bpc" id="L462" title="1 of 2 branches missed.">        register(java.sql.Date.class, throwException ? new SqlDateConverter()      : new SqlDateConverter(null));</span>
<span class="pc bpc" id="L463" title="1 of 2 branches missed.">        register(java.sql.Time.class, throwException ? new SqlTimeConverter()      : new SqlTimeConverter(null));</span>
<span class="pc bpc" id="L464" title="1 of 2 branches missed.">        register(Timestamp.class,     throwException ? new SqlTimestampConverter() : new SqlTimestampConverter(null));</span>
<span class="pc bpc" id="L465" title="1 of 2 branches missed.">        register(URL.class,           throwException ? new URLConverter()          : new URLConverter(null));</span>
<span class="fc" id="L466">    }</span>

    /**
     * Register array converters.
     *
     * @param throwException &lt;code&gt;true&lt;/code&gt; if the converters should
     * throw an exception when a conversion error occurs, otherwise &lt;code&gt;
     * &lt;code&gt;false&lt;/code&gt; if a default value should be used.
     * @param defaultArraySize The size of the default array value for array converters
     * (N.B. This values is ignored if &lt;code&gt;throwException&lt;/code&gt; is &lt;code&gt;true&lt;/code&gt;).
     * Specifying a value less than zero causes a &lt;code&gt;null&lt;code&gt; value to be used for
     * the default.
     */
    private void registerArrays(final boolean throwException, final int defaultArraySize) {

        // Primitives
<span class="fc" id="L482">        registerArrayConverter(Boolean.TYPE,   new BooleanConverter(),   throwException, defaultArraySize);</span>
<span class="fc" id="L483">        registerArrayConverter(Byte.TYPE,      new ByteConverter(),      throwException, defaultArraySize);</span>
<span class="fc" id="L484">        registerArrayConverter(Character.TYPE, new CharacterConverter(), throwException, defaultArraySize);</span>
<span class="fc" id="L485">        registerArrayConverter(Double.TYPE,    new DoubleConverter(),    throwException, defaultArraySize);</span>
<span class="fc" id="L486">        registerArrayConverter(Float.TYPE,     new FloatConverter(),     throwException, defaultArraySize);</span>
<span class="fc" id="L487">        registerArrayConverter(Integer.TYPE,   new IntegerConverter(),   throwException, defaultArraySize);</span>
<span class="fc" id="L488">        registerArrayConverter(Long.TYPE,      new LongConverter(),      throwException, defaultArraySize);</span>
<span class="fc" id="L489">        registerArrayConverter(Short.TYPE,     new ShortConverter(),     throwException, defaultArraySize);</span>

        // Standard
<span class="fc" id="L492">        registerArrayConverter(BigDecimal.class, new BigDecimalConverter(), throwException, defaultArraySize);</span>
<span class="fc" id="L493">        registerArrayConverter(BigInteger.class, new BigIntegerConverter(), throwException, defaultArraySize);</span>
<span class="fc" id="L494">        registerArrayConverter(Boolean.class,    new BooleanConverter(),    throwException, defaultArraySize);</span>
<span class="fc" id="L495">        registerArrayConverter(Byte.class,       new ByteConverter(),       throwException, defaultArraySize);</span>
<span class="fc" id="L496">        registerArrayConverter(Character.class,  new CharacterConverter(),  throwException, defaultArraySize);</span>
<span class="fc" id="L497">        registerArrayConverter(Double.class,     new DoubleConverter(),     throwException, defaultArraySize);</span>
<span class="fc" id="L498">        registerArrayConverter(Float.class,      new FloatConverter(),      throwException, defaultArraySize);</span>
<span class="fc" id="L499">        registerArrayConverter(Integer.class,    new IntegerConverter(),    throwException, defaultArraySize);</span>
<span class="fc" id="L500">        registerArrayConverter(Long.class,       new LongConverter(),       throwException, defaultArraySize);</span>
<span class="fc" id="L501">        registerArrayConverter(Short.class,      new ShortConverter(),      throwException, defaultArraySize);</span>
<span class="fc" id="L502">        registerArrayConverter(String.class,     new StringConverter(),     throwException, defaultArraySize);</span>

        // Other
<span class="fc" id="L505">        registerArrayConverter(Class.class,          new ClassConverter(),        throwException, defaultArraySize);</span>
<span class="fc" id="L506">        registerArrayConverter(java.util.Date.class, new DateConverter(),         throwException, defaultArraySize);</span>
<span class="fc" id="L507">        registerArrayConverter(Calendar.class,       new DateConverter(),         throwException, defaultArraySize);</span>
<span class="fc" id="L508">        registerArrayConverter(File.class,           new FileConverter(),         throwException, defaultArraySize);</span>
<span class="fc" id="L509">        registerArrayConverter(java.sql.Date.class,  new SqlDateConverter(),      throwException, defaultArraySize);</span>
<span class="fc" id="L510">        registerArrayConverter(java.sql.Time.class,  new SqlTimeConverter(),      throwException, defaultArraySize);</span>
<span class="fc" id="L511">        registerArrayConverter(Timestamp.class,      new SqlTimestampConverter(), throwException, defaultArraySize);</span>
<span class="fc" id="L512">        registerArrayConverter(URL.class,            new URLConverter(),          throwException, defaultArraySize);</span>

<span class="fc" id="L514">    }</span>

    /**
     * Register a new ArrayConverter with the specified element delegate converter
     * that returns a default array of the specified size in the event of conversion errors.
     *
     * @param componentType The component type of the array
     * @param componentConverter The converter to delegate to for the array elements
     * @param throwException Whether a conversion exception should be thrown or a default
     * value used in the event of a conversion error
     * @param defaultArraySize The size of the default array
     */
    private void registerArrayConverter(final Class&lt;?&gt; componentType, final Converter componentConverter,
            final boolean throwException, final int defaultArraySize) {
<span class="fc" id="L528">        final Class&lt;?&gt; arrayType = Array.newInstance(componentType, 0).getClass();</span>
<span class="fc" id="L529">        Converter arrayConverter = null;</span>
<span class="pc bpc" id="L530" title="1 of 2 branches missed.">        if (throwException) {</span>
<span class="nc" id="L531">            arrayConverter = new ArrayConverter(arrayType, componentConverter);</span>
        } else {
<span class="fc" id="L533">            arrayConverter = new ArrayConverter(arrayType, componentConverter, defaultArraySize);</span>
        }
<span class="fc" id="L535">        register(arrayType, arrayConverter);</span>
<span class="fc" id="L536">    }</span>

    /** strictly for convenience since it has same parameter order as Map.put */
    private void register(final Class&lt;?&gt; clazz, final Converter converter) {
<span class="fc" id="L540">        register(new ConverterFacade(converter), clazz);</span>
<span class="fc" id="L541">    }</span>

    /**
     * Remove any registered {@link Converter} for the specified destination
     * &lt;code&gt;Class&lt;/code&gt;.
     *
     * @param clazz Class for which to remove a registered Converter
     */
    public void deregister(final Class&lt;?&gt; clazz) {

<span class="fc" id="L551">        converters.remove(clazz);</span>

<span class="fc" id="L553">    }</span>


    /**
     * Look up and return any registered {@link Converter} for the specified
     * destination class; if there is no registered Converter, return
     * &lt;code&gt;null&lt;/code&gt;.
     *
     * @param clazz Class for which to return a registered Converter
     * @return The registered {@link Converter} or &lt;code&gt;null&lt;/code&gt; if not found
     */
    public Converter lookup(final Class&lt;?&gt; clazz) {

<span class="fc" id="L566">        return converters.get(clazz);</span>

    }

    /**
     * Look up and return any registered {@link Converter} for the specified
     * source and destination class; if there is no registered Converter,
     * return &lt;code&gt;null&lt;/code&gt;.
     *
     * @param sourceType Class of the value being converted
     * @param targetType Class of the value to be converted to
     * @return The registered {@link Converter} or &lt;code&gt;null&lt;/code&gt; if not found
     */
    public Converter lookup(final Class&lt;?&gt; sourceType, final Class&lt;?&gt; targetType) {

<span class="pc bpc" id="L581" title="1 of 2 branches missed.">        if (targetType == null) {</span>
<span class="nc" id="L582">            throw new IllegalArgumentException(&quot;Target type is missing&quot;);</span>
        }
<span class="fc bfc" id="L584" title="All 2 branches covered.">        if (sourceType == null) {</span>
<span class="fc" id="L585">            return lookup(targetType);</span>
        }

<span class="fc" id="L588">        Converter converter = null;</span>
        // Convert --&gt; String
<span class="fc bfc" id="L590" title="All 2 branches covered.">        if (targetType == String.class) {</span>
<span class="fc" id="L591">            converter = lookup(sourceType);</span>
<span class="pc bpc" id="L592" title="1 of 4 branches missed.">            if (converter == null &amp;&amp; (sourceType.isArray() ||</span>
<span class="fc bfc" id="L593" title="All 2 branches covered.">                        Collection.class.isAssignableFrom(sourceType))) {</span>
<span class="fc" id="L594">                converter = lookup(String[].class);</span>
            }
<span class="fc bfc" id="L596" title="All 2 branches covered.">            if (converter == null) {</span>
<span class="fc" id="L597">                converter = lookup(String.class);</span>
            }
<span class="fc" id="L599">            return converter;</span>
        }

        // Convert --&gt; String array
<span class="fc bfc" id="L603" title="All 2 branches covered.">        if (targetType == String[].class) {</span>
<span class="pc bpc" id="L604" title="1 of 4 branches missed.">            if (sourceType.isArray() || Collection.class.isAssignableFrom(sourceType)) {</span>
<span class="fc" id="L605">                converter = lookup(sourceType);</span>
            }
<span class="fc bfc" id="L607" title="All 2 branches covered.">            if (converter == null) {</span>
<span class="fc" id="L608">                converter = lookup(String[].class);</span>
            }
<span class="fc" id="L610">            return converter;</span>
        }

<span class="fc" id="L613">        return lookup(targetType);</span>

    }

    /**
     * Register a custom {@link Converter} for the specified destination
     * &lt;code&gt;Class&lt;/code&gt;, replacing any previously registered Converter.
     *
     * @param converter Converter to be registered
     * @param clazz Destination class for conversions performed by this
     *  Converter
     */
    public void register(final Converter converter, final Class&lt;?&gt; clazz) {

<span class="fc" id="L627">        converters.put(clazz, converter);</span>

<span class="fc" id="L629">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>